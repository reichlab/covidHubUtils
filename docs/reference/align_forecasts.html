<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Add reference dates and relative horizons to a dataframe of forecasts — align_forecasts • covidHubUtils</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Add reference dates and relative horizons to a dataframe of forecasts — align_forecasts"><meta property="og:description" content="Add reference dates and relative horizons to a dataframe of forecasts"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">covidHubUtils</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.7</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/covidHubUtils-overview.html">Tools for working with COVID-19 Forecast Hub data: a brief tour of the `covidHubUtils` R package</a>
    </li>
    <li>
      <a href="../articles/covidHubUtils-zoltar_sqlite_setup.html">Setup Instructions: Load Forecasts from Local Zoltar sqlite File</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/reichlab/covidHubUtils/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Add reference dates and relative horizons to a dataframe of forecasts</h1>
    <small class="dont-index">Source: <a href="https://github.com/reichlab/covidHubUtils/blob/HEAD/R/align.R" class="external-link"><code>R/align.R</code></a></small>
    <div class="hidden name"><code>align_forecasts.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Add reference dates and relative horizons to a dataframe of forecasts</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">align_forecasts</span><span class="op">(</span>
  <span class="va">forecasts</span>,
  reference_dates <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wk <span class="op">=</span> <span class="cn">NULL</span>, day <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span>,
  reference_weekday <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wk <span class="op">=</span> <span class="st">"Saturday"</span>, day <span class="op">=</span> <span class="st">"Monday"</span><span class="op">)</span>,
  reference_windows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>wk <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">:</span><span class="fl">2</span>, day <span class="op">=</span> <span class="op">-</span><span class="fl">6</span><span class="op">:</span><span class="fl">0</span><span class="op">)</span>,
  drop_nonpos_relative_horizons <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>forecasts</dt>
<dd><p>dataframe in format returned by <code>load_forecasts</code></p></dd>


<dt>reference_dates</dt>
<dd><p>a named list of vectors of reference dates for
forecasts, grouping forecasts that were made during the same week. The list
should have two components: "wk" providing reference dates for forecasts at
a weekly temporal resolution, and "day" providing reference dates for
forecasts at a daily temporal resolution. Dates may be a character vector in
the format "YYYY-MM-DD" or a vector of Dates. For example, if a forecast of
daily hospitalizations is issued with a forecast date that is Saturday,
2021-09-04, and we want to align analyses around a Monday, the reference
date would be Monday, 2021-09-06. This can be accomplished more easily by
providing the <code>reference_weekday</code> argument below.</p></dd>


<dt>reference_weekday</dt>
<dd><p>a named list or named character vector of weekdays
to use as reference dates. The list should contain entries named "wk" and
"day". The default uses "Saturday" as the reference weekday for forecasts
of weekly targets and "Monday" as the reference weekday for forecasts of
daily targets.</p></dd>


<dt>reference_windows</dt>
<dd><p>a named list of integer vectors with offset values
giving the set of forecast dates that should be assigned to a particular
reference date, in units of number of days. The function defaults to using
<code>-4:2</code> for forecasts at a weekly temporal resolution so that a forecast
issued on a Monday will have a reference date of the previous Saturday, and
<code>-6:0</code> for forecasts at a daily temporal resolution so that all forecasts
with a <code>forecast_date</code> in the week leading up to a particular Monday will be
assigned a reference date of that Monday.</p></dd>


<dt>drop_nonpos_relative_horizons</dt>
<dd><p>boolean indicating whether forecasts that have a
non-positive horizon relative to the reference date should be dropped.
Defaults to <code>TRUE</code></p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>forecast dataframe augmented by columns reference_date and
relative_horizon</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span class="r-in"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/reichlab/covidHubUtils" class="external-link">covidHubUtils</a></span><span class="op">)</span></span>
<span class="r-in"><span class="va">hub_repo_path</span> <span class="op">&lt;-</span> <span class="st">"../covid19-forecast-hub"</span></span>
<span class="r-in"><span class="va">dates</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.Date.html" class="external-link">seq.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-05-01"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">"2021-06-01"</span><span class="op">)</span>, by <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="va">forecasts</span> <span class="op">&lt;-</span> <span class="fu"><a href="load_forecasts.html">load_forecasts</a></span><span class="op">(</span></span>
<span class="r-in">  models <span class="op">=</span> <span class="fu"><a href="get_all_models.html">get_all_models</a></span><span class="op">(</span>source <span class="op">=</span> <span class="st">"local_hub_repo"</span>, hub_repo_path <span class="op">=</span> <span class="va">hub_repo_path</span><span class="op">)</span>,</span>
<span class="r-in">  dates <span class="op">=</span> <span class="va">dates</span><span class="op">[</span><span class="op">!</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/weekday.POSIXt.html" class="external-link">weekdays</a></span><span class="op">(</span><span class="va">dates</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Monday"</span>, <span class="st">"Sunday"</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>,</span>
<span class="r-in">  date_window_size <span class="op">=</span> <span class="fl">0</span>,</span>
<span class="r-in">  locations <span class="op">=</span> <span class="st">"US"</span>,</span>
<span class="r-in">  types <span class="op">=</span> <span class="st">"quantile"</span>,</span>
<span class="r-in">  source <span class="op">=</span> <span class="st">"local_hub_repo"</span>,</span>
<span class="r-in">  hub_repo_path <span class="op">=</span> <span class="va">hub_repo_path</span>,</span>
<span class="r-in">  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span class="r-in">  as_of <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span class="r-in">  hub <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span><span class="op">)</span></span>
<span class="r-in"><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">quantile</span> <span class="op">==</span> <span class="fl">.5</span><span class="op">)</span></span>
<span class="r-in"><span class="va">forecasts</span></span>
<span class="r-in"><span class="va">forecasts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span></span>
<span class="r-in"><span class="va">forecasts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">align_forecasts</span><span class="op">(</span><span class="op">)</span></span>
<span class="r-in"><span class="va">forecasts</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu">align_forecasts</span><span class="op">(</span>drop_nonpos_relative_horizons <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span class="r-in">  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">relative_horizon</span> <span class="op">&lt;=</span> <span class="fl">0</span><span class="op">)</span></span>
<span class="r-in"><span class="op">}</span></span>
<span class="r-in"></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Yijin Serena Wang, Ariane Stark, Evan L Ray, Nikos I. Bosse, Nicholas G. Reich, Nutcha Wattanachit.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.4.</p>
</div>

      </footer></div>

  


  

  </body></html>

